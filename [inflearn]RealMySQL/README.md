## ep.01 CHAR vs VARCHAR

### 공통점

- 최대 저장 가능 문자 길이를 명시하는 문자열 저장 컬럼

### 차이점

- CHAR 타입은 할당된 문자 길이와 상관없이 항상 고정된 공간을 할당해서 사용한다.
- CHAR 는 최대 255 VARCHAR는 최대 16383 글자까지 저장 가능하다
- VARCHAT 타입은 실제로 저장된 문자의 바이트 수를 별도로 관리한다. (길이 저장 바이트)
- 가변길이 문자셋(UTF8MB4)을 사용하는 경우에는 CHAR 타입도 저장된 값의 길이를 같이 관리한다.
- 공간을 미리 예약하는가 하지 않는가의 차이이다.

> 일반적으로 알려진 고정길이 값인 경우에 VARCHAR 를 사용해야 한다는 인식은 아무런 의미가 없다. (바이트 하나 정도의 차이이기 때문에)

### CHAR 사용해야할 경우

- 가변 폭이 큰 경우에 낭비가 심할 수 있다. (1~ 100 글자)
- 가변 폭이 크지 않다면 낭비는 크지 않다. (90 ~100 글자)
- 자주 변경되는 경우 (특히 인덱싱 된 컬럼)

> VARCHAR 타입은 값의 길이 변경시(update) 새로운 공간을 찾아서 저장하기에 변경이 잦아지면 컴팩션이 필요할 수 있지만, CHAR 타입 사용시엔 그러한 공간 낭비를 보완할 수 있다.

---

## ep.02 VARCHAR vs TEXT

### 공통점

- 문자열 타입
- 최대 65,535 Bytes까지 저장 가능

### 차이점

- VARCHAR는 최대 글자 수 만큼만 저장 가능
- TEXT 타입은 인덱스 생성시 Prefix 길이 지정 필요
- TEXT 타입은 표현식으로만 디폴트 값 지정 가능

> VARCHAR 타입은 메모리 버퍼 공간을 미리 할당해두며 재활용하고, TEXT 타입은 필요할 때마다 할당/해제 한다. 컬럼 사용이 빈번하다면, VARCHAR 이 권장된다.
> 반면, 길이가 긴 VARCHAR 컬럼이 자주 추가된다면, Row 최대 사이즈에 영향이 가지 않도록 TEXT 타입이 권장된다.
> VARCHAR 타입은 실제 최대 사용길이 만큼 명시해야 메모리 효율 증가

### 주의사항

저장되는 값의 사이즈가 크면 Off-page 형태로 데이터가 저장될 수 있다.
이 경우에 실제 내부 페이지에는 포인터값만 저장된다.

**Off-page 컬럼 참조여부에 따라 쿼리 성능이 매우 달라진다.**

이러한 이유 때문에 쿼리의 SELECT 절에는 가능한 필요한 컬럼만 명시해야한다.

### 정리

- 저장되는 데이터 사이즈가 크고 컬럼을 자주 사용하지 않으며, 테이블 내에 다른 문자열 컬럼이 많다면 -> TEXT
- DB 메모리 용량이 충분하고 자주 사용되며, 데이터 사이즈가 많이 크지 않다면 -> VARCHAR

—
