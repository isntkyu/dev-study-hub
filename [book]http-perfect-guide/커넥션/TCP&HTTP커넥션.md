# 4 . 커넥션 관리

---

## 4.1 TCP 커넥션

### 브라우저에 주소를 입력했을 때

- 브라우저가 호스트명에 대한 ip 주소를 찾는다
- 브라우저가 포트번호(80) 을 얻는다.
- 브라우저가 TCP 커넥션을 생성한다.
- 브라우저가 서버로 HTTP GET 메시지 보낸다.
- 브라우저가 서버에서 온 HTTP 응답 메시지 읽는다.
- 브라우저가 커넥션을 끊는다.

### HTTPS

HTTP와 TCP 사이에 TSL/SSL 을 더한 보안계층

TCP 커넥션은
발신자 ip 주소, 발신자 포트, 수신자 ip주소, 수신자 포트 로 식별.

### TCP 소켓 프로그래밍

소켓 API

- TCP 엔드포인트 데이터 구조 생성하고 원격 데이터 구조를 연결하여 데이터 스트림을 읽고 쓸수있음.
- TCP API 는 기본적인 것들 및 세부사항을 외부로부터 숨긴다.
- 소켓생성 -> 커넥션 허가 -> 커넥션 기다림 -> 요청 보내고 읽고 기다리고 처리 -> ㄱ닫는다.

---

## 4.2 TCP 성능에 대한 고려

- HTTP 트랜잭션의 성능은 그 아래 계층인 TCP 성능에 영향을 받기마련.

### http 트랜잭션을 지연시키는 원인

- 방문한 적이 없는 호스트는 DNS 인프라를 사용하여 ip 변환이 오래걸림 (DNS 캐시 없으면)
- 클라이언트가 서버에 tcp 커넥션 요청을 보내고 응답을 기다림.
- 읽고 처리.
- 웹서버가 http 응답을 보내는 시간

---

## 4.3 HTTP 커넥션 관리

### 흔히 잘못 이해하는 Connection 헤더

HTTP는 클라이언트와 서버 사이에 중개 서버들이 놓이는 것을 허락하고 중개 서버들을 거치면서 전달된다.

HTTP Connection 헤더 필드는 다른 커넥션에는 전달되지 않는 토큰을 쉼표로 구분.

Http 앱은 메시지를 받으면, 요청에 기술된 모든 옵션을 적용한 후 다음 홉에 메시지 전달하기 전에 커넥션 헤더를 삭제한다. **헤더 보호하기**

### 순차적인 트랜잭션 처리에 의한 지연

커넥션관리가 제대로 이루어지지 않으면 TCP 성능이 매우 안 좋아질 수 있다.

3개의 이미지가 있는 웹페이지는 4개의 http 트랜잭션이 필요함.(html 받기 + 이미지 3개)
각 트랜잭션이 새로운 커넥션을 필요로 한다면 느린시작 지연이 발생할 것이다.(순차적)

사용자는 여러개의 이미지가 동시에 로드되는 것을 좋아함.

또 하나의 단점,
특정 브라우저는 객체의 크기를 알아야 화면에 배치가 가능한데 모든 객체를 받기 전까진 텅 빈 화면을 보여주게 될 수 있음.

---

HTTP 커넥션 성능을 개선 시킬 최신 기술

- 병렬 커넥션
- 지속 커넥션
- 파이프라인 커넥션
- 다중 커넥션
