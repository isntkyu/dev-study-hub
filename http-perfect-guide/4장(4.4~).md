## 4.4 병렬 커넥션

Http는 클라이언트가 여러개의 커넥션을 맺음으로써 여러 HTTP 트랜잭션을 병렬로 처리할 수 있게 한다. (여러 개의 서버와 맺어질 수 있어야 한다.)

---

### 4.4.1 병렬 커넥션은 페이지를 더 빠르게 내려받는다.

이미지들을 병렬로 내려받아 커넥션 지연이 겹쳐짐으로써 총 지연시간이 줄어든다.

---

### 4.4.2 병렬 커넥션이 항상 더 빠르지는 않다.

클라이언트 네트워크 대역폭이 좁을 때, 성능상의 장점은 거의 없어진다.
대부분 시간을 데이터 전송하는 데에 쓰일 것이다.

(여러 커넥션 생성하면서 생기는 부하 때문에도 오래 걸릴 수 있다.)

> 브라우저는 실제로 적은 수의 병렬(대부분 4개) 커넥션만을 허용한다.

서버는 특정 클라이언트로부터 과도한 수의 커넥션이 맺어지면 임의로 끊을 수 있다.

---

### 4.4.3 병렬 커넥션은 더 빠르지 '느껴질' 수 있다.

---

## 4.5 지속 커넥션

HTTP / 1.1 을 지원하는 기기는 처리 완료 후에도 TCP 커넥션을 유지하여 앞으로 있을 HTTP 요청에 재사용할 수 있다.

이 때의 TCP 커넥션을 지속커넥션 이라고 부른다.

---

### 4.5.1 지속 커넥션 vs 병렬 커넥션

병렬 커넥션의 단점

- 각 트랜잭션마다 새로운 커넥션을 맺고 끊기 때문에 시간과 대역폭 소요된다.
- 각각 새로운 커넥션은 TCP 느린 시작 때문에 성능이 떨어진다.
- 실제로 연결할 수 있는 병렬 커넥션의 수엔 제한이 있다.

지속 커넥션의 장점

- 사전 작업과 지연을 줄임.
- 튜닝된 커넥션 유지
- 커넥션 수 줄임

애플리케이션은 적은 수의 병렬 커넥션만을 맺고 유지한다.

- HTTP/1.0+ keep-alive
- HTTP/1.1 '지속'

---

### 4.5.2 HTTP/1.0+의 Keep-Alive 커넥션

![[Pasted image 20220821155655.png]]

---

### 4.5.3 Keep-Alive 동작

HTTP/1.1에선 빠졌지만 아직 널리 사용되고 있기 때문에 그것을 처리할 수 있게 개발해야한다.

커넥션 유지를 위해 Connection: Keep-Alive 헤더를 포함시킨다.
요청을 받은 서버는 다음 요청도 이 커넥션을 통해 받고 싶으면 같은 헤더를 응답에 포함시킨다.

---

### 4.5.4 Keep-Alive 옵션

Connection: Keep-Alive 옵션이 있어야 사용가능
Keep-Alive: max = 5, timeout = 120

이 헤더와 옵션들은 반드시 그대로 동작한다는 보장없이 그대로 동작하길 바라는 정보.
